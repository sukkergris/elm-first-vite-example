name: elm-first

services:
  dev:
    # Instructions on how to build the image for this service
    build:
      # Use the current directory (.devcontainer) as the build context
      context: .
      dockerfile: Dockerfile.devmachine

    # Define volumes to mount
    volumes:
      # Mount the entire project directory (one level up from .devcontainer)
      # into the /workspace directory inside the container.
      # 'cached' optimizes mount performance on macOS/Windows.
      - ..:/workspaces:cached
      - elm-first-vite-example:/home/container-user/.elm
    # Command to run when the container starts.
    # 'sleep infinity' keeps the container running indefinitely so VS Code can attach.
    command: sleep infinity

  nginx:
    image: nginx:alpine
    container_name: elm-first-nginx
    ports:
      - "80:80"
      - "443:443"
    networks:
      - internal
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
      - ./ssl:/etc/nginx/certs:ro
    depends_on:
      - dev
volumes:
  elm-first-vite-example:

networks:
  internal:
    driver: bridge

